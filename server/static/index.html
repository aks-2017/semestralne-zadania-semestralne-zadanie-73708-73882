<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mininet_wifi playground</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gojs/1.8.2/go.js"></script>
    
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="static/style.css">



</head>
<body>

<div class="container">


        <h2 class="text-center">Vytvorenie topologie</h2>
        <div class="row">
            <label >Pocet stanic</label>
            <div class="col-xs-3 col-xs-offset-3">
                <div class="input-group number-spinner">
				<span class="input-group-btn">
					<button class="btn btn-default" data-dir="dwn"><span class="glyphicon glyphicon-minus"></span></button>
				</span>
                    <input id="in_st" type="text" class="form-control text-center" value="1" >
                    <span class="input-group-btn">
					<button class="btn btn-default" data-dir="up"><span class="glyphicon glyphicon-plus"></span></button>
				</span>
                </div>
            </div>
        </div>

        <div class="row">
            <label>Pocet pristupovych bodov</label>
            <div class="col-xs-3 col-xs-offset-3">
                <div class="input-group number-spinner">
				<span class="input-group-btn">
					<button class="btn btn-default" data-dir="dwn"><span class="glyphicon glyphicon-minus"></span></button>
				</span>
                    <input id="in_ap" type="text" class="form-control text-center" value="1" >
                    <span class="input-group-btn">
					<button class="btn btn-default" data-dir="up"><span class="glyphicon glyphicon-plus"></span></button>
				</span>
                </div>
            </div>
        </div>
    <div class="row">
        <button class="cudlik btn btn-lg btn-primary col-xs-3 col-xs-offset-3" onclick="create();">Create TOPO</button>
        </div>
<div class="row">
    <span id="myspan"></span>
</div>


    <div id="myDiagramDiv" style="border: solid 1px black; width:100%; height:600px"></div>
  <p> Diagram zobrazuje realtime polohu stanic a pristupovych bodov. Moze sa zdat ze sa pristupove body pohybuju tiez, avsak ich pozicia sa nemeni,
    je to sposobene len skalovanim grafu podla toho ako daleko su od seba krajne stanice.
  </p>

<div class="row">
  <button class="cudlik btn btn-lg btn-primary col-md-3 col-md-offset-2" onclick="reset();">Reset TOPO</button>
  <button class="cudlik btn btn-lg btn-primary col-md-3 col-md-offset-1" onclick="shutdown();">Shutdown server</button>
</div>


</div>

</body>

<script>

var resetnute=true; //pri resete potrebujem zastavit autoupdate

    $(document).on('click', '.number-spinner button', function () {
        var btn = $(this),
            oldValue = btn.closest('.number-spinner').find('input').val().trim(),
            newVal = 0;

        if (btn.attr('data-dir') == 'up') {
            if(oldValue<10) newVal = parseInt(oldValue) + 1;
            else newVal =10;
        } else {
            if (oldValue > 1) {
                newVal = parseInt(oldValue) - 1;
            } else {
                newVal = 1;
            }
        }
        btn.closest('.number-spinner').find('input').val(newVal);
    });


       function create(){            
            var station = $('#in_st').val();
            var ap = $('#in_ap').val();
            var list = {ap,station}
            $.ajax({
                url: '/create',
                data: JSON.stringify(list),
                contentType: "application/json",
                type: 'POST',
                success: function(response) {
                    document.getElementById("myspan").textContent=response.sprava;
                    init();
                },
                error: function(error) {
                    console.log(error);
                }
            });
        

        };


function init() {


    resetnute=false;
    
    var $ = go.GraphObject.make;
    myDiagram =
      $(go.Diagram, "myDiagramDiv",
        { isReadOnly: true, allowSelect: false, contentAlignment: go.Spot.Center, }, { "animationManager.isEnabled": false });
    myDiagram.nodeTemplateMap.add("st",
      $(go.Node, "Auto",
        { locationSpot: go.Spot.Center },
        new go.Binding("location", "loc", go.Point.parse),
        

        $(go.Shape, "Circle",
          {
            fill: "rgba(0,128,0,0.2)", stroke: null,
            width: 150, height: 150
          }),

        $(go.TextBlock, { margin: 5, font: "bold 26px Georgia, Serif" },
        new go.Binding("text", "name"))
        
      ));

    myDiagram.nodeTemplateMap.add("ap",
      $(go.Node, "Spot",
        { locationSpot: go.Spot.Center },
        new go.Binding("location", "loc", go.Point.parse),
        
        $(go.Panel, "Spot",
                  
          
          $(go.Shape, "Circle",
          {
            fill: "rgba(128,0,0,0.2)", stroke: null,
            width: 300, height: 300
          }),

        $(go.TextBlock, { margin: 5, font: "bold 26px Georgia, Serif" },
        new go.Binding("text", "name"))
                    
      )
      ));
    
 
    autoUpdate();
    
}

function update(data){
   
    
    myDiagram.model = new go.GraphLinksModel(data);
  myDiagram.requestUpdate();
}


function autoUpdate()
{
    $.ajax({
        method:         'GET',
        url:            '/graph/positions', 
        dataType:       'json',

        success: function(result) 
        {   
            
            update(result);
            if (!resetnute) setTimeout(autoUpdate, 100);
        }
    });
  }

  function reset(){
    resetnute=true;
    $.ajax({
        method:         'GET',
        url:            '/reset', 
        dataType:       'text',
        success: function(result){   
          document.getElementById("myspan").textContent=result;
        }
    });
  }

  function shutdown(){
    
    $.ajax({
        method:         'GET',
        url:            '/shutdown' 
        
    });
  }


</script>


</html>

